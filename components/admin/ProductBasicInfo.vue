<!--
  Product Basic Info Component
  
  Handles basic product information fields with mobile optimizations
  Extracted from ProductForm.vue for better maintainability
  
  Features:
  - Multi-language product name inputs
  - SKU and category selection
  - Mobile-friendly form design
  - Touch optimizations and haptic feedback
-->

<template>
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-6">
      {{ $t('admin.products.sections.basicInfo') }}
    </h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Product Name -->
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          {{ $t('admin.products.fields.name') }} *
        </label>
        <div class="space-y-3">
          <div v-for="locale in locales" :key="locale.code">
            <label class="block text-xs text-gray-500 dark:text-gray-400 mb-1">
              {{ locale.name }}
            </label>
            <input
              ref="nameInputs"
              v-model="localForm.name[locale.code]"
              type="text"
              :placeholder="$t('admin.products.placeholders.productName', { language: locale.name })"
              class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white touch-manipulation"
              :class="{ 
                'border-red-500': errors?.name?.[locale.code],
                'min-h-[44px]': isMobile
              }"
              @input=\"handleNameInput(locale.code)\"\n              @focus=\"handleInputFocus\"\n              @blur=\"handleInputBlur\"\n            />\n            <p v-if=\"errors?.name?.[locale.code]\" class=\"mt-1 text-sm text-red-600\">\n              {{ errors.name[locale.code] }}\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <!-- SKU -->\n      <div>\n        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          {{ $t('admin.products.fields.sku') }} *\n        </label>\n        <div class=\"relative\">\n          <input\n            ref=\"skuInput\"\n            v-model=\"localForm.sku\"\n            type=\"text\"\n            :placeholder=\"$t('admin.products.placeholders.sku')\"\n            class=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white touch-manipulation\"\n            :class=\"{ \n              'border-red-500': errors?.sku,\n              'min-h-[44px]': isMobile,\n              'pr-10': isGeneratingSku\n            }\"\n            @input=\"handleSkuInput\"\n            @focus=\"handleInputFocus\"\n            @blur=\"handleInputBlur\"\n          />\n          <!-- Auto-generate SKU button -->\n          <button\n            v-if=\"!localForm.sku && localForm.name.es\"\n            @click=\"generateSku\"\n            @touchstart=\"isMobile && vibrate('tap')\"\n            type=\"button\"\n            class=\"absolute right-2 top-1/2 transform -translate-y-1/2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 touch-manipulation\"\n            :class=\"{ 'p-1': isMobile }\"\n            :title=\"$t('admin.products.actions.generateSku')\"\n          >\n            <Icon name=\"heroicons:sparkles\" class=\"w-4 h-4\" />\n          </button>\n          <!-- Loading spinner for SKU generation -->\n          <div\n            v-if=\"isGeneratingSku\"\n            class=\"absolute right-2 top-1/2 transform -translate-y-1/2\"\n          >\n            <Icon name=\"heroicons:arrow-path\" class=\"w-4 h-4 animate-spin text-blue-600\" />\n          </div>\n        </div>\n        <p v-if=\"errors?.sku\" class=\"mt-1 text-sm text-red-600\">\n          {{ errors.sku }}\n        </p>\n        <p v-if=\"skuSuggestion\" class=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\n          {{ $t('admin.products.hints.skuSuggestion', { suggestion: skuSuggestion }) }}\n        </p>\n      </div>\n\n      <!-- Category -->\n      <div>\n        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          {{ $t('admin.products.fields.category') }} *\n        </label>\n        <select\n          v-model=\"localForm.categoryId\"\n          class=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white touch-manipulation\"\n          :class=\"{ \n            'border-red-500': errors?.categoryId,\n            'min-h-[44px]': isMobile\n          }\"\n          @change=\"handleCategoryChange\"\n          @focus=\"handleInputFocus\"\n        >\n          <option value=\"\">{{ $t('admin.products.placeholders.selectCategory') }}</option>\n          <option v-for=\"category in categories\" :key=\"category.id\" :value=\"category.id\">\n            {{ getLocalizedText(category.name) }}\n          </option>\n        </select>\n        <p v-if=\"errors?.categoryId\" class=\"mt-1 text-sm text-red-600\">\n          {{ errors.categoryId }}\n        </p>\n        <p v-if=\"selectedCategoryInfo\" class=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\n          {{ selectedCategoryInfo }}\n        </p>\n      </div>\n    </div>\n\n    <!-- Mobile-specific help text -->\n    <div v-if=\"isMobile && showMobileHints\" class=\"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n      <div class=\"flex items-start space-x-3\">\n        <Icon name=\"heroicons:light-bulb\" class=\"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0\" />\n        <div class=\"text-sm text-blue-800 dark:text-blue-200\">\n          <p class=\"font-medium mb-1\">{{ $t('admin.products.hints.mobileTitle') }}</p>\n          <ul class=\"space-y-1 text-xs\">\n            <li>{{ $t('admin.products.hints.mobile1') }}</li>\n            <li>{{ $t('admin.products.hints.mobile2') }}</li>\n            <li>{{ $t('admin.products.hints.mobile3') }}</li>\n          </ul>\n        </div>\n        <button\n          @click=\"showMobileHints = false\"\n          @touchstart=\"vibrate('tap')\"\n          class=\"text-blue-600 dark:text-blue-400 touch-manipulation p-1\"\n        >\n          <Icon name=\"heroicons:x-mark\" class=\"w-4 h-4\" />\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport type { CategoryWithChildren } from '~/types/database'\n\ninterface Props {\n  modelValue: {\n    name: Record<string, string>\n    sku: string\n    categoryId: number | null\n  }\n  categories: CategoryWithChildren[]\n  errors?: Record<string, any>\n  disabled?: boolean\n}\n\ninterface Emits {\n  (e: 'update:modelValue', value: Props['modelValue']): void\n  (e: 'validate'): void\n  (e: 'sku-generated', sku: string): void\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  disabled: false\n})\n\nconst emit = defineEmits<Emits>()\n\n// Composables\nconst { isMobile } = useDevice()\nconst { vibrate } = useHapticFeedback()\nconst { t, locale } = useI18n()\n\n// Template refs\nconst nameInputs = ref<HTMLInputElement[]>([])\nconst skuInput = ref<HTMLInputElement>()\n\n// Local state\nconst localForm = ref({ ...props.modelValue })\nconst isGeneratingSku = ref(false)\nconst skuSuggestion = ref('')\nconst showMobileHints = ref(isMobile.value)\nconst isFocused = ref(false)\n\n// Locales for multilingual support\nconst locales = [\n  { code: 'es', name: 'Spanish' },\n  { code: 'en', name: 'English' },\n  { code: 'ro', name: 'Romanian' }\n]\n\n// Computed\nconst selectedCategoryInfo = computed(() => {\n  if (!localForm.value.categoryId) return ''\n  \n  const category = props.categories.find(c => c.id === localForm.value.categoryId)\n  if (!category) return ''\n  \n  const productCount = category.products?.length || 0\n  return t('admin.products.hints.categoryInfo', { count: productCount })\n})\n\n// Utility functions\nconst getLocalizedText = (text: Record<string, string> | null) => {\n  if (!text) return ''\n  return text[locale.value] || text.es || Object.values(text)[0] || ''\n}\n\nconst generateSkuFromName = (name: string) => {\n  return name\n    .toLowerCase()\n    .replace(/[^a-z0-9\\s]/g, '') // Remove special characters\n    .replace(/\\s+/g, '-') // Replace spaces with hyphens\n    .substring(0, 20) // Limit length\n    .replace(/-+$/, '') // Remove trailing hyphens\n}\n\n// Event handlers\nconst handleInputFocus = () => {\n  isFocused.value = true\n  if (isMobile.value) {\n    vibrate('tap')\n  }\n}\n\nconst handleInputBlur = () => {\n  isFocused.value = false\n  emit('validate')\n}\n\nconst handleNameInput = (localeCode: string) => {\n  // Auto-generate SKU suggestion from primary language (Spanish)\n  if (localeCode === 'es' && localForm.value.name.es && !localForm.value.sku) {\n    skuSuggestion.value = generateSkuFromName(localForm.value.name.es)\n  }\n  \n  updateModel()\n  \n  if (isMobile.value) {\n    vibrate('light')\n  }\n}\n\nconst handleSkuInput = () => {\n  // Clear suggestion when user types their own SKU\n  if (localForm.value.sku) {\n    skuSuggestion.value = ''\n  }\n  \n  updateModel()\n  \n  if (isMobile.value) {\n    vibrate('light')\n  }\n}\n\nconst handleCategoryChange = () => {\n  updateModel()\n  \n  if (isMobile.value) {\n    vibrate('medium')\n  }\n}\n\nconst generateSku = async () => {\n  if (!localForm.value.name.es) return\n  \n  isGeneratingSku.value = true\n  \n  try {\n    // Simulate API call or use actual SKU generation logic\n    await new Promise(resolve => setTimeout(resolve, 500))\n    \n    const generated = generateSkuFromName(localForm.value.name.es)\n    localForm.value.sku = generated\n    skuSuggestion.value = ''\n    \n    emit('sku-generated', generated)\n    updateModel()\n    \n    if (isMobile.value) {\n      vibrate('success')\n    }\n    \n    // Focus the SKU input for easy editing\n    nextTick(() => {\n      skuInput.value?.focus()\n    })\n  } catch (error) {\n    console.error('Failed to generate SKU:', error)\n    \n    if (isMobile.value) {\n      vibrate('error')\n    }\n  } finally {\n    isGeneratingSku.value = false\n  }\n}\n\nconst updateModel = () => {\n  emit('update:modelValue', { ...localForm.value })\n}\n\n// Watch for prop changes\nwatch(() => props.modelValue, (newValue) => {\n  localForm.value = { ...newValue }\n}, { deep: true })\n\n// Auto-focus first input on desktop\nonMounted(() => {\n  if (!isMobile.value && nameInputs.value?.[0]) {\n    nextTick(() => {\n      setTimeout(() => {\n        nameInputs.value[0]?.focus()\n      }, 100)\n    })\n  }\n})\n</script>\n\n<style scoped>\n.touch-manipulation {\n  touch-action: manipulation;\n  -webkit-tap-highlight-color: transparent;\n}\n\n/* Enhanced focus states for accessibility */\ninput:focus,\nselect:focus {\n  @apply ring-2 ring-blue-500 ring-offset-2 dark:ring-offset-gray-800;\n}\n\n/* Mobile keyboard optimization */\n@media (max-width: 640px) {\n  input[type=\"text\"] {\n    font-size: 16px; /* Prevents zoom on iOS */\n  }\n}\n\n/* Smooth transitions */\n.transition-colors {\n  transition-property: background-color, border-color, color;\n  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  transition-duration: 200ms;\n}\n</style>"