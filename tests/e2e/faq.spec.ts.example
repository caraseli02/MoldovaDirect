/**
 * E2E tests for FAQ page
 * This is an EXAMPLE test file showing recommended test coverage
 * Rename to faq.spec.ts and implement after reviewing
 */

import { test, expect } from '@playwright/test'

test.describe('FAQ Page', () => {
  test.describe('Page Rendering', () => {
    test('should display FAQ page in all locales', async ({ page }) => {
      const locales = ['es', 'en', 'ro', 'ru']

      for (const locale of locales) {
        await page.goto(`/${locale}/faq`)

        // Check page title exists
        await expect(page.locator('h1')).toBeVisible()

        // Check all 4 main sections are present
        const sectionCount = await page.locator('section').count()
        expect(sectionCount).toBeGreaterThanOrEqual(4)
      }
    })

    test('should display all FAQ sections', async ({ page }) => {
      await page.goto('/en/faq')

      // Verify section headers
      const sections = ['Orders', 'Payments', 'Returns', 'Products']

      for (const section of sections) {
        await expect(page.locator('h2', { hasText: section })).toBeVisible()
      }
    })

    test('should display FAQ items in each section', async ({ page }) => {
      await page.goto('/en/faq')

      // Each section should have at least 3 items
      const articles = await page.locator('article').count()
      expect(articles).toBeGreaterThanOrEqual(12) // 4 sections Ã— 3 items
    })
  })

  test.describe('Navigation', () => {
    test('should have working quick links', async ({ page }) => {
      await page.goto('/en/faq')

      // Check quick links sidebar
      await expect(page.getByRole('link', { name: /shipping/i })).toBeVisible()
      await expect(page.getByRole('link', { name: /returns/i })).toBeVisible()
      await expect(page.getByRole('link', { name: /track/i })).toBeVisible()
      await expect(page.getByRole('link', { name: /contact/i })).toBeVisible()
    })

    test('should navigate to contact page from CTA', async ({ page }) => {
      await page.goto('/en/faq')

      // Click "Talk to support" CTA
      const supportLink = page.getByRole('link', { name: /talk to support/i })
      await expect(supportLink).toBeVisible()

      await supportLink.click()
      await page.waitForURL(/.*\/contact/)

      expect(page.url()).toContain('/contact')
    })

    test('should navigate to track order page', async ({ page }) => {
      await page.goto('/en/faq')

      const trackLink = page.getByRole('link', { name: /track.*order/i }).first()
      await expect(trackLink).toBeVisible()

      await trackLink.click()
      await page.waitForURL(/.*\/track-order/)

      expect(page.url()).toContain('/track-order')
    })
  })

  test.describe('Internationalization', () => {
    test('should switch languages correctly', async ({ page }) => {
      // Start with Spanish
      await page.goto('/es/faq')
      await expect(page.locator('h1')).toContainText('Preguntas frecuentes')

      // Switch to English
      await page.goto('/en/faq')
      await expect(page.locator('h1')).toContainText('Frequently Asked Questions')

      // Switch to Romanian
      await page.goto('/ro/faq')
      await expect(page.locator('h1')).toBeVisible() // Romanian title

      // Switch to Russian
      await page.goto('/ru/faq')
      await expect(page.locator('h1')).toBeVisible() // Russian title
    })

    test('should maintain route structure across locales', async ({ page }) => {
      const locales = ['es', 'en', 'ro', 'ru']

      for (const locale of locales) {
        await page.goto(`/${locale}/faq`)
        expect(page.url()).toContain(`/${locale}/faq`)

        // Page should load without errors
        await expect(page.locator('h1')).toBeVisible()
      }
    })
  })

  test.describe('Responsive Design', () => {
    test('should be mobile responsive', async ({ page }) => {
      await page.setViewportSize({ width: 375, height: 667 }) // iPhone SE
      await page.goto('/en/faq')

      // Header should be visible
      await expect(page.locator('h1')).toBeVisible()

      // Quick links sidebar should adapt (may stack on mobile)
      await expect(page.locator('aside')).toBeVisible()
    })

    test('should be tablet responsive', async ({ page }) => {
      await page.setViewportSize({ width: 768, height: 1024 }) // iPad
      await page.goto('/en/faq')

      await expect(page.locator('h1')).toBeVisible()
      await expect(page.locator('aside')).toBeVisible()
    })

    test('should be desktop optimized', async ({ page }) => {
      await page.setViewportSize({ width: 1920, height: 1080 })
      await page.goto('/en/faq')

      // Desktop layout should show sidebar next to content
      await expect(page.locator('h1')).toBeVisible()
      await expect(page.locator('aside')).toBeVisible()
    })
  })

  test.describe('SEO & Accessibility', () => {
    test('should have proper meta tags', async ({ page }) => {
      await page.goto('/en/faq')

      // Check title
      const title = await page.title()
      expect(title).toContain('FAQ')

      // Check meta description
      const description = await page.locator('meta[name="description"]').getAttribute('content')
      expect(description).toBeTruthy()
      expect(description!.length).toBeGreaterThan(50)
    })

    test('should have structured data', async ({ page }) => {
      await page.goto('/en/faq')

      // Check for JSON-LD structured data
      const structuredData = await page.locator('script[type="application/ld+json"]').first()
      await expect(structuredData).toBeAttached()

      const content = await structuredData.textContent()
      expect(content).toContain('FAQPage')
      expect(content).toContain('Question')
    })

    test('should use semantic HTML', async ({ page }) => {
      await page.goto('/en/faq')

      // Check for semantic elements
      await expect(page.locator('article')).toHaveCount(12) // FAQ items
      await expect(page.locator('aside')).toBeVisible()     // Sidebar
      await expect(page.locator('section')).toHaveCount(4)  // Sections
    })

    test('should not have console errors', async ({ page }) => {
      const errors: string[] = []

      page.on('console', msg => {
        if (msg.type() === 'error') {
          errors.push(msg.text())
        }
      })

      await page.goto('/en/faq')

      // Wait for page to fully load
      await page.waitForLoadState('networkidle')

      // Check no errors occurred
      expect(errors).toHaveLength(0)
    })
  })

  test.describe('Dark Mode', () => {
    test('should support dark mode toggle', async ({ page }) => {
      await page.goto('/en/faq')

      // Find and click dark mode toggle (adjust selector as needed)
      const darkModeToggle = page.locator('[aria-label*="dark" i], [aria-label*="theme" i]').first()

      if (await darkModeToggle.isVisible()) {
        await darkModeToggle.click()

        // Verify dark mode class is applied
        const html = page.locator('html')
        const classes = await html.getAttribute('class')

        // Dark mode should toggle (either 'dark' class or removal)
        expect(classes).toBeTruthy()
      }
    })
  })

  test.describe('Content Verification', () => {
    test('should display all support highlights', async ({ page }) => {
      await page.goto('/en/faq')

      // Support highlights should be visible
      await expect(page.getByText(/same day/i)).toBeVisible()
      await expect(page.getByText(/packaging/i)).toBeVisible()
      await expect(page.getByText(/support/i)).toBeVisible()
    })

    test('should show updated timestamp', async ({ page }) => {
      await page.goto('/en/faq')

      // "Updated" text should be present
      await expect(page.getByText(/updated/i)).toBeVisible()
    })

    test('should display response time and language info', async ({ page }) => {
      await page.goto('/en/faq')

      // Check for response time
      await expect(page.getByText(/response time/i)).toBeVisible()

      // Check for supported languages
      await expect(page.getByText(/ES.*EN.*RO.*RU/i)).toBeVisible()
    })
  })
})
